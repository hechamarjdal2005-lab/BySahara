import React, { useState } from "react";

// ─── Types ────────────────────────────────────────────────────────────
interface Province {
  id: string;
  nameAr: string;
  nameEn: string;
  nameFr: string;
  // SVG polygon points (from Inkscape)
  points?: string;
  // SVG path (for complex shapes)
  path?: string;
  lx: number;
  ly: number;
  products: { ar: string; en: string };
  color: string;
  fillIdle: string;
  fillHover: string;
  fillSelected: string;
}

// ─── Province Data ────────────────────────────────────────────────────
// SVG viewBox from Inkscape: 0 0 278.6 274.24
// We use the polygon points directly from the uploaded SVG
const provinceList: Province[] = [
  {
    id: "sidi-ifni",
    nameAr: "سيدي إفني",
    nameEn: "Sidi Ifni",
    nameFr: "Sidi Ifni",
    // Polygon 3 — small northern shape (Sidi Ifni detached)
    // + Polygon 1 (eastern coast / Sidi Ifni main area) combined via two <polygon> tags
    // We render them as separate elements in the SVG below
    lx: 165,
    ly: 82,
    color: "#2A7D6E",
    fillIdle: "#E8F5F2",
    fillHover: "#C5E8E2",
    fillSelected: "#2A7D6E",
    products: { ar: "السمك، أركان، العسل", en: "Fish, Argan, Honey" },
  },
  {
    id: "guelmim",
    nameAr: "كلميم",
    nameEn: "Guelmim",
    nameFr: "Guelmim",
    // Polygon 2 — Northern area
    points: "192.03 86.33 192.14 87.34 192.17 87.89 192.26 88.22 192.54 88.57 192.81 88.9 192.83 89.1 192.78 89.47 192.67 89.84 193.47 91.02 193.6 91.17 193.93 91.53 194.12 91.69 194.37 92.02 194.61 92.43 194.73 92.85 194.82 93.41 195.09 94.45 195.48 95.67 195.37 95.95 195.13 96.08 194.89 96.25 193.21 97.42 192.59 97.87 192.17 98.24 192.01 98.48 191.8 98.76 191.72 98.97 191.68 99.17 191.78 99.3 191.94 99.39 192.22 99.53 192.42 99.57 192.81 99.72 192.87 99.81 192.9 100.09 192.86 100.23 192.79 100.37 192.65 100.49 192.52 100.58 192.32 100.66 192.12 100.74 191.87 100.85 191.62 100.99 190.97 101.62 190.57 101.99 190.38 102.06 190.22 102.1 190.1 102.1 189.82 101.97 189.67 101.77 189.67 101.51 189.9 101.11 190.31 100.6 190.76 100.19 190.94 100.01 191.02 99.82 190.94 99.68 190.86 99.63 190.75 99.63 190.63 99.63 190.44 99.64 190.26 99.71 189.93 99.88 189.73 100.02 189.45 100.17 189.19 100.25 188.27 100.47 188.01 100.66 188.24 101.02 188.71 101.74 188.9 102.41 188.78 104 188.69 104.33 188.47 104.5 188.31 104.83 188.4 105.12 188.68 105.21 188.87 105.25 189.18 105.25 189.44 105.34 189.78 105.45 189.95 105.63 189.99 105.8 189.89 105.91 189.76 106.07 189.38 106.86 189.12 107.39 189.06 107.75 189.34 108.47 190.11 109.18 190.58 109.67 191.03 109.85 191.85 109.9 192.71 109.86 192.24 110.81 191.62 112.9 191.41 113.84 191.25 114.61 191.39 115.33 192.27 116.19 192.92 116.91 193.23 117.26 193.27 117.91 193.47 118.52 193.8 118.72 193.97 118.71 194.22 118.6 194.46 118.39 194.59 118.31 194.78 118.22 195.01 118.19 195.15 118.24 195.39 118.31 195.54 118.39 195.72 118.74 195.73 119.93 195.77 120.81 195.87 121.31 195.47 121.26 194.22 121.28 193.1 121.11 192.3 120.93 191.35 120.56 190.5 120.08 189.8 119.61 189.2 118.98 188.28 118.11 187.78 117.66 187.01 116.98 186.08 115.99 185.09 115.31 184.09 114.61 183.41 114.21 182.96 114.99 182.61 115.66 182.11 116.26 181.49 116.73 180.44 117.33 179.47 117.93 177.26 118.63 176.96 118.74 176.61 118.89 176.3 119.04 175.91 119.17 175.59 119.28 175.13 119.37 174.7 119.35 174.2 119.24 173.85 119.24 173.43 119.35 173.15 119.48 172.51 119.69 171.52 120.12 170.61 120.5 169.95 120.65 169.1 120.72 168.48 120.85 167.75 121.28 166.97 121.79 166.7 122.41 166.31 122.54 165.91 122.52 165.01 123.03 164.65 123.45 163.34 124.08 163.05 124.24 161.57 125.05 159.96 125.83 156.32 127.25 154.35 128.22 152.95 128.67 151.33 128.81 149.65 128.97 149.39 128.98 148.34 129.04 147.36 129.16 145.41 129.81 143.15 130.61 141.95 130.79 141.21 130.86 140.59 131.13 140.04 131.34 136.01 131.1 131.96 130.85 130.5 128.78 130.5 126.15 130.28 125.47 129.33 124.16 129.38 123.85 128.38 123.26 127.61 123.66 125.67 124.59 123.44 125.84 122.54 126.53 122.12 126.79 121.2 126.9 119.5 127.42 118.63 127.92 117.76 129.24 117.07 130.82 116.58 132.24 116.05 132.05 115.07 131.85 114.71 131.4 113.81 131.29 113.4 130.91 111.95 130.86 111.62 130.76 111.6 130.31 111.59 130.07 110.91 129.86 110.2 129.74 110.01 129.57 109.92 128.96 109.82 128.54 109.61 128.08 109.24 127.62 108.62 127.17 107.42 126.5 106.84 126.26 106.51 126.09 106.74 125.74 106.57 125.49 106.08 125.47 105.49 125.59 104.81 125.7 104.03 125.64 103.37 125.43 102.53 124.83 101.75 124.28 101.38 123.83 101.05 122.7 100.83 121.13 100.34 120.37 99.83 119.67 99.51 118.9 99.33 118.11 99.1 117.53 99.74 117.17 100.19 116.68 100.59 116.05 101.01 115.42 101.53 114.69 101.81 114.36 102.07 114.14 102.42 113.88 102.94 113.57 103.19 113.47 103.79 113.29 104.14 113.27 104.51 113.14 105.46 112.63 106.25 112.21 106.95 111.8 107.61 111.51 108.36 111.32 110.85 110.13 111.55 109.78 112.24 109.54 112.6 109.38 115.23 108.17 116.45 107.65 117.2 107.25 117.22 107.24 120.56 105.51 121.2 105.21 121.52 105.03 123.14 104.09 124.21 103.45 124.68 103.08 125.13 102.86 125.65 102.57 127.22 101.55 127.83 101.02 128.46 100.5 128.72 100.22 129.17 99.79 130.13 98.82 130.69 98.17 130.96 97.79 131.27 97.4 131.46 97.3 131.71 97.28 132.03 96.79 132.25 96.41 132.46 96.08 132.7 95.75 133.11 95.01 133.22 94.88 133.9 95.29 134.63 95.62 135 95.79 135.19 96.06 135.32 96.35 135.53 96.42 135.66 96.41 135.84 96.39 135.99 96.39 136.13 96.54 136.43 97.23 136.72 97.5 136.87 97.58 137 97.56 137.09 97.54 137.25 97.34 137.44 97.02 137.69 96.75 137.96 96.58 138.69 96.6 139.39 96.62 139.57 96.55 139.79 96.45 140.06 96.32 140.16 96.24 140.31 96.23 140.48 96.34 140.71 96.69 140.92 96.96 141.37 97.03 141.68 97 142.01 96.95 142.12 96.91 142.36 96.85 142.56 96.8 142.71 96.8 143.01 97.29 143.33 97.91 143.45 98.21 143.22 98.67 143.14 99.12 142.84 99.47 143.74 99.9 144.18 99.96 144.53 100.03 144.77 100.16 145.12 100.56 145.28 100.8 145.39 100.99 146.64 101.09 147.2 100.92 147.79 100.67 148.39 100.43 148.53 100.43 147.88 99.04 148.4 98.42 149.57 97.49 150.42 96.72 151.18 95.99 151.56 95.64 152.08 95.72 152.57 95.77 153.22 95.42 154.04 94.79 154.64 94.41 155.08 94.22 155.49 94.19 155.66 94.25 156.3 94.46 157.31 95.25 158.75 96.07 159.38 96.64 159.93 97.11 160.34 96.34 160.39 95.57 160.34 95.01 160.24 94.46 160.33 94.05 160.48 93.94 160.96 93.94 161.49 93.92 161.98 93.91 162.07 93.94 162.26 93.54 162.26 93.27 162.14 92.91 161.97 92.51 161.72 91.97 161.54 91.05 161.4 90.37 161.5 89.97 161.54 89.81 161.85 89.36 162.48 88.95 163.34 88.66 163.9 88.33 164.14 88.23 164.17 87.94 164.21 87.54 164.26 87.27 164.44 87.27 164.71 87.27 164.95 87.36 165.43 87.45 165.81 87.45 166.12 87.22 166.23 86.89 166.48 86.84 166.84 86.91 167.38 86.91 167.4 87.25 167.4 87.63 167.58 88.12 167.87 88.64 167.88 88.66 168.29 89.55 169.07 90.82 169.29 91.25 169.68 91.57 170.18 91.96 170.43 92.04 170.81 92.02 171.09 91.92 171.69 91.9 172.05 91.84 172.51 91.66 173.09 91.33 173.95 90.55 175.28 89.47 175.87 88.88 176.09 88.59 176.12 88.41 175.79 88.03 175.16 87.58 175.07 87.36 175.11 87.15 175.26 87.02 175.49 86.95 175.72 86.9 176.05 86.89 176.37 86.88 176.65 86.87 176.98 86.86 177.22 86.89 177.5 86.99 178.34 87.41 178.6 87.51 178.79 87.58 178.95 87.9 179.44 88.57 180.06 89.13 180.26 89.31 180.47 89.4 180.73 89.45 180.98 89.47 180.98 89.5 180.99 89.49 182.19 89.12 183.23 88.63 184.29 87.97 184.75 87.44 185.41 86.94 185.7 86.66 185.92 86.5 186.46 86.74 186.88 86.91 187.22 87.01 187.7 87.08 188.19 87.12 188.84 87.11 189.29 87.06 189.88 86.91 190.25 86.7 191.09 85.98 191.38 85.47 191.55 85.08 191.75 84.71 192.03 86.33",
    lx: 155,
    ly: 110,
    color: "#5B7F3A",
    fillIdle: "#EEF5E6",
    fillHover: "#D6EAC0",
    fillSelected: "#5B7F3A",
    products: { ar: "أركان، العسل، الكسكس", en: "Argan, Honey, Couscous" },
  },
  {
    id: "tan-tan",
    nameAr: "طانطان",
    nameEn: "Tan-Tan",
    nameFr: "Tan-Tan",
    // Polygon 4 — Western area
    points: "104.03 125.64 104.81 125.7 105.49 125.59 106.08 125.47 106.57 125.49 106.74 125.74 106.51 126.09 106.84 126.26 107.42 126.5 108.62 127.17 109.24 127.62 109.61 128.08 109.82 128.54 109.92 128.96 110.01 129.57 110.2 129.74 110.91 129.87 111.59 130.07 111.6 130.31 111.62 130.76 111.95 130.86 113.4 130.91 113.81 131.29 114.71 131.4 115.07 131.85 116.05 132.05 116.58 132.24 116.97 132.38 118.07 132.52 119.76 132.8 121.16 133.28 123.08 133.76 124.07 134.31 124.84 134.45 125.56 134.64 126.33 135.55 127.32 136.54 128.08 137.61 128.59 138.31 129.69 139.97 131.05 141.82 131.7 142.86 131.82 144.22 132.64 146.63 133.38 148.91 133.97 151.53 134.44 153.37 135.03 155.94 135.6 158.08 136.03 159.43 136.37 160.66 136.61 162.48 136.84 164.07 137.3 165.97 137.56 167.13 137.64 168.19 137.32 168.24 135.8 168.08 135.23 167.74 134.42 167.37 133.63 167.26 133.06 167.22 132.34 167.16 130.98 167.16 129.4 167.32 127.06 167.41 124.71 167.62 123.78 167.43 122.95 167.14 122.09 166.71 121.56 166.42 120.93 166.38 120.14 166.35 119.45 166.35 118.64 166.47 118.03 166.48 117.16 166.48 116.29 166.32 115.72 166.07 114.95 166.1 109.5 166.13 104.34 166.25 103.17 166.44 102.6 166.59 101.77 166.5 100.12 166.33 98.8 166.63 98.16 166.82 97.8 166.93 95.81 167.54 95.44 167.34 94.2 166.84 93.25 166.41 92.2 166.09 91.21 165.87 89.71 165.66 88.73 165.26 87.93 164.79 86.76 164.29 85.95 164.2 84.39 164.12 79.2 164.22 77.49 162.47 75.97 160.31 74.73 158.58 74.08 156.87 72.47 151.93 72.19 151.12 72.02 150.63 71.52 149.68 70 148.42 69.71 147.72 69.01 146 67.89 142.98 67.09 140.81 67.14 140.79 68.91 140.21 69.94 139.86 70.83 139.59 71.94 139.4 72.64 139.23 74.06 138.9 75.26 138.53 76.34 138.09 77.15 137.75 77.79 137.45 78.53 137.26 79.36 136.91 80.11 136.45 80.77 135.99 81.15 135.67 81.36 135.48 81.79 135.47 82.88 134.62 83.05 134.32 83.1 134.08 83.15 133.78 83.15 133.54 83.25 133.29 83.72 132.78 83.96 132.58 84.18 132.36 84.53 132.26 84.8 132.21 85.19 131.92 85.41 131.43 85.7 131.01 85.92 130.71 86.02 130.3 86.02 129.98 86.13 129.72 86.34 129.66 86.67 129.61 86.91 129.57 87.03 129.48 87.26 129.3 87.59 128.96 87.91 128.63 88.13 128.36 88.34 128.03 88.36 127.59 88.43 127.24 88.5 126.87 88.61 126.52 89.1 126.11 89.47 125.77 89.51 125.72 90.09 125.15 92.05 123.68 92.61 123.23 93.18 122.78 93.66 122.38 93.91 122 94.16 121.47 94.44 121.17 94.9 120.71 95.49 120.39 96.27 119.98 96.81 119.49 97.37 118.97 97.98 118.37 98.33 118.05 98.8 117.7 99.1 117.53 99.33 118.11 99.51 118.9 99.83 119.67 100.34 120.37 100.83 121.13 101.05 122.7 101.38 123.83 101.75 124.28 102.53 124.83 103.37 125.43 104.03 125.64",
    lx: 120,
    ly: 148,
    color: "#C97B2E",
    fillIdle: "#FDF3E7",
    fillHover: "#FAE2C2",
    fillSelected: "#C97B2E",
    products: { ar: "التمور، حليب الإبل، الحرف", en: "Dates, Camel Milk, Crafts" },
  },
  {
    id: "assa-zag",
    nameAr: "أسا الزاك",
    nameEn: "Assa-Zag",
    nameFr: "Assa-Zag",
    // Polygon 1 — Eastern large area
    points: "189.2 118.98 189.8 119.61 190.5 120.08 191.35 120.56 192.3 120.93 193.1 121.11 194.22 121.28 195.47 121.26 195.87 121.31 196.89 121.59 197.84 122.03 198.79 122.59 199.51 122.95 200.31 123.44 200.81 123.85 201.19 124.29 201.56 124.98 201.93 125.46 201.98 125.92 201.93 126.61 201.9 127.3 203.03 128.79 205.17 131.8 206.4 133.49 207.42 134.99 208.65 136.81 211.93 141.74 213.52 144.02 212.93 158.69 212.92 158.75 212.79 162.05 210.98 195.33 210.7 214.34 207.21 214.24 205.81 213.92 205.02 213.48 202.81 212.46 201.74 211.83 200.24 210.68 199.09 209.55 197.63 207.95 197 207.16 196.36 206.14 195.55 204.81 194.75 203.46 193.32 201.44 192.5 200.12 191.1 198.06 190.28 196.48 189.29 195.05 187.62 192.55 186.99 191.56 186.66 190.96 186.34 190.34 185.45 189.01 185.02 188.27 184.64 187.82 184.6 187.79 184.3 187.5 183.8 187.23 182.99 186.84 182.48 186.89 181.82 187.18 181.33 187.31 180.31 188.13 177.84 189.7 177.05 189.81 176.01 189.96 173.42 190 171.95 190 171.22 189.77 170.03 189.4 169.2 189.13 168.04 188.69 166.96 188.39 166.33 188.05 164.35 186.63 162.5 185.44 161.46 184.54 160.59 183.48 159.49 182.18 158.78 181.24 157.75 180.08 156.12 178.33 155.3 177.57 154.44 177.17 153.7 176.77 153.43 176.78 152.46 176.91 150.66 177.08 149.55 177.08 148.68 176.71 147.78 176.14 145.62 174.91 143.78 173.81 142.06 172.82 141.51 172.24 140.12 170.77 138.85 169.2 137.64 168.19 137.56 167.13 137.3 165.97 136.84 164.07 136.61 162.48 136.37 160.66 136.03 159.43 135.6 158.08 135.03 155.94 134.44 153.37 133.97 151.53 133.38 148.91 132.64 146.63 131.82 144.22 131.7 142.86 131.05 141.82 129.69 139.97 128.59 138.31 128.08 137.61 127.32 136.54 126.33 135.55 125.56 134.64 124.84 134.45 124.07 134.31 123.08 133.76 121.16 133.28 119.76 132.8 118.07 132.52 116.97 132.38 116.58 132.24 117.07 130.82 117.76 129.24 118.63 127.92 119.5 127.42 121.2 126.9 122.12 126.79 122.54 126.53 123.44 125.84 125.67 124.59 127.61 123.66 128.38 123.26 129.38 123.84 129.33 124.16 130.28 125.46 130.5 126.15 130.5 128.78 131.96 130.85 136.01 131.1 140.04 131.34 140.59 131.13 141.21 130.86 141.95 130.79 143.15 130.61 145.41 129.81 147.36 129.16 148.34 129.04 149.39 128.98 149.65 128.97 151.33 128.8 152.95 128.67 154.35 128.22 156.32 127.25 159.96 125.83 161.57 125.05 163.05 124.24 163.35 124.08 164.65 123.45 165.01 123.03 165.91 122.52 166.31 122.54 166.7 122.41 166.97 121.79 167.75 121.28 168.48 120.85 169.1 120.72 169.95 120.65 170.61 120.5 171.52 120.12 172.51 119.69 173.15 119.48 173.43 119.35 173.85 119.24 174.2 119.24 174.7 119.35 175.13 119.37 175.59 119.28 175.91 119.17 176.3 119.04 176.61 118.89 176.96 118.74 177.26 118.63 179.47 117.93 180.44 117.33 181.49 116.73 182.11 116.26 182.61 115.66 182.96 114.99 183.41 114.21 184.09 114.61 185.09 115.31 186.08 115.99 187.01 116.98 187.78 117.66 188.28 118.11 189.2 118.98",
    lx: 190,
    ly: 170,
    color: "#8B6BB1",
    fillIdle: "#F3EEF9",
    fillHover: "#E0D3F0",
    fillSelected: "#8B6BB1",
    products: { ar: "التمور، أركان، العسل", en: "Dates, Argan, Honey" },
  },
];

// Sidi Ifni has 2 separate polygons from the SVG
const sidiIfniPolygons = {
  main: "189.2 118.98 189.8 119.61 190.5 120.08 191.35 120.56 192.3 120.93 193.1 121.11 194.22 121.28 195.47 121.26 195.87 121.31 196.89 121.59 197.84 122.03 198.79 122.59 199.51 122.95 200.31 123.44 200.81 123.85 201.19 124.29 201.56 124.98 201.93 125.46 201.98 125.92 201.93 126.61 201.9 127.3 203.03 128.79 205.17 131.8 206.4 133.49 207.42 134.99 208.65 136.81 211.93 141.74 213.52 144.02 212.93 158.69 212.92 158.75 212.79 162.05 210.98 195.33 210.7 214.34 207.21 214.24 205.81 213.92 205.02 213.48 202.81 212.46 201.74 211.83 200.24 210.68 199.09 209.55 197.63 207.95 197 207.16 196.36 206.14 195.55 204.81 194.75 203.46 193.32 201.44 192.5 200.12 191.1 198.06 190.28 196.48 189.29 195.05 187.62 192.55 186.99 191.56 186.66 190.96 186.34 190.34 185.45 189.01 185.02 188.27 184.64 187.82 184.6 187.79 184.3 187.5 183.8 187.23 182.99 186.84 182.48 186.89 181.82 187.18 181.33 187.31 180.31 188.13 177.84 189.7 177.05 189.81 176.01 189.96 173.42 190 171.95 190 171.22 189.77 170.03 189.4 169.2 189.13 168.04 188.69 166.96 188.39 166.33 188.05 164.35 186.63 162.5 185.44 161.46 184.54 160.59 183.48 159.49 182.18 158.78 181.24 157.75 180.08 156.12 178.33 155.3 177.57 154.44 177.17 153.7 176.77 153.43 176.78 152.46 176.91 150.66 177.08 149.55 177.08 148.68 176.71 147.78 176.14 145.62 174.91 143.78 173.81 142.06 172.82 141.51 172.24 140.12 170.77 138.85 169.2 137.64 168.19 137.56 167.13 137.3 165.97 136.84 164.07 136.61 162.48 136.37 160.66 136.03 159.43 135.6 158.08 135.03 155.94 134.44 153.37 133.97 151.53 133.38 148.91 132.64 146.63 131.82 144.22 131.7 142.86 131.05 141.82 129.69 139.97 128.59 138.31 128.08 137.61 127.32 136.54 126.33 135.55 125.56 134.64 124.84 134.45 124.07 134.31 123.08 133.76 121.16 133.28 119.76 132.8 118.07 132.52 116.97 132.38 116.58 132.24 117.07 130.82 117.76 129.24 118.63 127.92 119.5 127.42 121.2 126.9 122.12 126.79 122.54 126.53 123.44 125.84 125.67 124.59 127.61 123.66 128.38 123.26 129.38 123.84 129.33 124.16 130.28 125.46 130.5 126.15 130.5 128.78 131.96 130.85 136.01 131.1 140.04 131.34 140.59 131.13 141.21 130.86 141.95 130.79 143.15 130.61 145.41 129.81 147.36 129.16 148.34 129.04 149.39 128.98 149.65 128.97 151.33 128.8 152.95 128.67 154.35 128.22 156.32 127.25 159.96 125.83 161.57 125.05 163.05 124.24 163.35 124.08 164.65 123.45 165.01 123.03 165.91 122.52 166.31 122.54 166.7 122.41 166.97 121.79 167.75 121.28 168.48 120.85 169.1 120.72 169.95 120.65 170.61 120.5 171.52 120.12 172.51 119.69 173.15 119.48 173.43 119.35 173.85 119.24 174.2 119.24 174.7 119.35 175.13 119.37 175.59 119.28 175.91 119.17 176.3 119.04 176.61 118.89 176.96 118.74 177.26 118.63 179.47 117.93 180.44 117.33 181.49 116.73 182.11 116.26 182.61 115.66 182.96 114.99 183.41 114.21 184.09 114.61 185.09 115.31 186.08 115.99 187.01 116.98 187.78 117.66 188.28 118.11 189.2 118.98",
  north: "153.83 75.85 154.51 75.89 154.79 75.77 155.13 75.64 155.52 75.4 155.77 75.17 156.1 74.89 156.5 74.66 156.62 74.61 156.94 74.61 157.12 74.61 157.41 74.61 157.67 74.58 157.83 74.56 158.01 74.51 158.14 74.37 158.22 74.22 158.22 73.99 158.29 73.8 158.38 73.62 158.5 73.48 158.58 73.43 158.64 73.39 158.68 73.35 158.88 73.94 158.96 74.41 158.94 74.92 158.88 75.33 158.72 75.78 158.21 76.47 157.66 76.95 157.49 77.22 157.46 77.48 157.55 77.73 157.92 77.95 158.37 78.86 158.86 78.94 158.82 79 158.72 79.16 158.59 79.41 158.67 79.69 158.64 79.99 158.91 80.14 159.25 80.03 159.31 80.23 159.66 80.56 159.95 80.57 160.29 80.79 160.57 80.91 160.94 80.99 161.5 80.97 161.84 80.95 162.37 80.89 162.67 80.83 163.26 80.61 163.54 80.53 163.76 80.3 163.92 80.02 164.1 79.8 164.51 79.8 164.79 79.8 165.17 79.74 165.4 79.62 165.6 79.4 165.84 79.17 166.08 78.87 166.19 78.59 166.33 78.46 166.38 78.46 166.63 78.46 166.92 78.52 167.03 78.64 167.1 78.87 167.12 79.09 167.17 79.33 167.35 79.33 167.51 79.33 167.73 79.38 167.89 79.45 167.93 79.52 168.05 79.67 168.23 79.81 168.63 79.95 169.08 80.17 169.28 80.39 169.28 80.53 169.26 80.74 169.19 80.92 169.09 81.38 169.09 81.58 169.13 81.92 169.13 82.32 169.12 82.46 169.33 82.2 169.52 81.95 169.64 81.81 169.79 81.68 169.92 81.64 170.08 81.65 170.28 81.81 170.3 81.22 170.1 80.55 170.01 80.17 169.89 79.78 169.78 79.5 169.64 79.2 169.55 78.99 169.41 78.76 169.34 78.63 169.71 78.7 170.01 79 170.37 79.34 170.78 79.77 171.06 80.26 171.29 80.53 171.54 80.62 171.75 80.62 172.1 80.4 172.31 79.91 172.56 79.59 172.65 79.2 172.71 78.84 172.74 78.54 172.97 78.31 173.48 78.01 173.73 77.83 173.93 77.73 174.04 78 174.13 78.4 174.25 78.78 174.38 79.06 174.5 79.22 174.97 79.42 175.37 79.86 175.66 80.2 175.69 80.51 175.78 80.56 175.8 80.59 175.85 80.61 175.89 80.65 175.94 80.66 175.97 80.69 175.99 80.71 176.03 80.74 176.08 80.78 176.12 80.81 176.2 80.91 176.27 80.96 176.35 81.07 176.37 81.09 176.4 81.11 176.42 81.13 176.44 81.13 176.46 81.13 176.48 81.13 176.5 81.13 176.51 81.12 176.51 81.11 176.55 81.09 176.58 81.05 176.61 81 176.61 80.98 176.66 80.93 176.66 80.9 176.68 80.85 176.72 80.73 176.87 80.49 177.02 80.18 177.08 80.11 177.1 80.07 177.15 79.99 177.17 79.96 177.22 79.85 177.24 79.81 177.26 79.79 177.29 79.75 177.3 79.75 177.31 79.74 177.34 79.73 177.35 79.73 177.4 79.74 177.43 79.75 177.43 79.77 177.44 79.78 177.46 79.78 177.47 79.81 177.49 79.82 177.5 79.84 177.55 79.94 177.6 80.01 177.63 80.08 177.66 80.14 177.85 80.33 177.93 80.33 178.03 80.33 178.22 80.33 178.38 80.33 178.43 80.33 178.5 80.33 178.58 80.33 178.64 80.34 178.71 80.37 178.74 80.37 178.81 80.4 178.89 80.43 178.93 80.44 178.98 80.49 179.07 80.52 179.13 80.59 179.18 80.62 179.2 80.65 179.3 80.73 179.34 80.78 179.36 80.8 179.4 80.86 179.44 80.92 179.49 80.97 179.54 81.05 179.6 81.1 179.78 81.19 179.79 81.19 179.8 81.19 179.81 81.19 179.87 81.17 179.88 81.16 179.91 81.15 179.93 81.13 179.94 81.11 179.97 81.08 180.01 81.04 180.04 81 180.06 80.98 180.09 80.95 180.19 80.83 180.22 80.76 180.26 80.69 180.27 80.67 180.28 80.63 180.32 80.6 180.34 80.59 180.39 80.57 180.35 80.45 180.29 80.29 180.24 80.16 180.24 80.03 180.24 79.87 180.37 79.82 180.5 79.82 180.66 79.82 180.71 79.87 180.74 79.93 180.82 80 180.93 80.11 180.98 80.11 181.13 79.9 181.13 79.87 181.21 79.61 181.26 79.58 181.42 79.58 181.74 79.53 181.76 79.53 182.03 79.53 182.05 79.45 182.13 79.32 182.18 79.17 182.26 78.98 182.42 78.69 182.52 78.25 182.71 77.78 182.98 77.24 183.17 77.22 184.04 77.28 184.3 77.03 184.39 77.01 184.68 76.99 184.94 77.03 185.33 77.21 185.64 77.41 185.87 77.62 186.1 77.78 186.35 77.87 186.56 77.87 186.97 77.85 187.13 78.01 187.42 78.3 188.07 78.79 188.43 78.99 188.52 79.04 189 79.4 189.53 79.81 190 80.31 190.37 80.88 190.89 81.64 191.49 82.63 192.21 83.68 191.95 84.33 191.75 84.71 191.55 85.08 191.38 85.47 191.09 85.98 190.25 86.7 189.88 86.91 189.29 87.06 188.84 87.11 188.19 87.12 187.7 87.08 187.22 87.01 186.88 86.91 186.46 86.74 185.92 86.5 185.7 86.66 185.41 86.94 184.75 87.44 184.29 87.97 183.23 88.63 182.19 89.12 180.99 89.49 180.98 89.5 180.98 89.48 180.73 89.45 180.47 89.4 180.26 89.31 180.06 89.13 179.44 88.57 178.95 87.91 178.79 87.58 178.6 87.51 178.35 87.41 177.5 86.99 177.22 86.89 176.98 86.86 176.65 86.87 176.37 86.88 176.05 86.89 175.72 86.9 175.49 86.95 175.26 87.02 175.11 87.15 175.07 87.36 175.16 87.58 175.79 88.03 176.12 88.41 176.09 88.59 175.87 88.88 175.28 89.47 173.95 90.55 173.09 91.33 172.51 91.66 172.05 91.84 171.69 91.9 171.09 91.92 170.81 92.03 170.43 92.04 170.18 91.96 169.68 91.57 169.29 91.25 169.07 90.82 168.29 89.55 167.88 88.66 167.87 88.64 167.58 88.12 167.4 87.63 167.4 87.25 167.38 86.91 166.84 86.91 166.48 86.84 166.23 86.89 166.12 87.22 165.81 87.45 165.43 87.45 164.95 87.36 164.71 87.27 164.44 87.27 164.26 87.27 164.21 87.54 164.17 87.94 164.14 88.24 163.9 88.33 163.34 88.66 162.48 88.95 161.85 89.36 161.54 89.81 161.5 89.97 161.4 90.37 161.54 91.05 161.72 91.97 161.97 92.51 162.14 92.91 162.26 93.27 162.26 93.54 162.07 93.94 161.98 93.91 161.49 93.92 160.96 93.94 160.48 93.94 160.33 94.05 160.24 94.46 160.34 95.01 160.39 95.57 160.35 96.34 159.93 97.11 159.38 96.64 158.75 96.07 157.31 95.25 156.3 94.46 155.66 94.25 155.49 94.19 155.08 94.22 154.64 94.41 154.04 94.79 153.22 95.42 152.57 95.77 152.08 95.72 151.56 95.64 151.18 95.99 150.42 96.73 149.57 97.49 148.4 98.42 147.88 99.04 148.53 100.43 148.39 100.43 147.79 100.67 147.2 100.92 146.64 101.09 145.39 100.99 145.28 100.8 145.12 100.56 144.77 100.16 144.53 100.03 144.18 99.96 143.74 99.9 142.84 99.47 143.14 99.12 143.22 98.67 143.45 98.21 143.33 97.91 143.01 97.29 142.71 96.8 142.56 96.8 142.36 96.85 142.12 96.91 142.01 96.95 141.68 97 141.37 97.03 140.92 96.96 140.71 96.69 140.48 96.34 140.31 96.23 140.16 96.24 140.06 96.32 139.79 96.45 139.57 96.55 139.39 96.62 138.69 96.6 137.96 96.58 137.69 96.75 137.44 97.02 137.25 97.34 137.09 97.54 137 97.56 136.87 97.58 136.72 97.5 136.43 97.23 136.13 96.54 135.99 96.39 135.84 96.39 135.66 96.41 135.53 96.42 135.32 96.35 135.19 96.06 135 95.79 134.63 95.62 133.9 95.29 133.54 94.49 134.67 93.22 135.28 92.53 135.83 91.92 136.18 91.52 137.76 89.85 138.1 89.48 138.89 88.93 139.19 88.7 139.25 88.55 139.35 88.43 139.42 88.4 140.51 87.91 141.16 87.3 142.02 86.77 142.39 86.53 142.64 86.25 142.82 85.97 143.19 85.42 143.31 84.96 143.5 84.56 143.65 84.34 143.66 84.33 143.87 84.12 143.96 83.85 144.24 83.69 144.27 83.42 144.27 83.11 144.3 82.86 144.79 82.34 145.16 81.88 145.41 81.51 145.72 81.2 145.94 81 146.24 80.75 146.57 80.36 146.96 80 147.16 79.85 147.47 79.69 147.83 79.25 147.99 78.84 148.14 78.48 148.42 78.02 148.63 77.63 148.83 77.22 149.09 76.91 149.3 76.78 149.5 76.55 149.79 76.17 149.87 75.98 149.94 75.8 150.05 75.58 150.13 75.33 150.16 75.14 150.15 74.98 150.1 74.51 150.22 74.38 150.35 74.28 150.51 74.26 150.51 74.07 150.41 73.88 150.43 73.73 150.53 73.67 150.72 73.65 150.81 73.59 150.87 73.36 150.81 73.13 150.77 72.96 150.77 72.81 150.94 72.39 151.19 72.1 151.29 71.87 151.44 71.7 151.65 71.57 151.92 71.41 152.09 71.14 152.32 70.78 152.55 70.38 152.89 69.74 152.95 69.62 153.08 69.39 153.17 69.24 153.17 69.23 153.44 69.41 153.54 69.52 153.54 69.68 153.54 69.92 153.56 70.13 153.6 70.35 153.65 70.51 153.75 70.65 153.85 70.74 153.93 70.84 153.96 70.99 153.95 71.28 153.94 71.52 153.91 71.66 153.83 71.89 153.89 72.04 154 72.07 154.18 72.12 154.3 72.19 154.3 72.33 154.26 72.58 154.18 72.84 154.14 72.99 154.1 73.31 154.07 73.69 154.07 73.88 153.95 74.12 153.8 74.27 153.65 74.39 153.52 74.52 153.43 74.8 153.43 75.03 153.54 75.37 153.65 75.67 153.64 75.84 153.83 75.85",
};

// ─── Props ────────────────────────────────────────────────────────────
interface GuelmimMapProps {
  selectedProvince: string | null;
  onSelectProvince: (id: string | null) => void;
  activeProvinces: string[];
  language?: string;
  variant?: "sidebar" | "full";
}

// ─── Component ────────────────────────────────────────────────────────
const GuelmimMap: React.FC<GuelmimMapProps> = ({
  selectedProvince,
  onSelectProvince,
  activeProvinces,
  language = "ar",
  variant = "sidebar",
}) => {
  const [hovered, setHovered] = useState<string | null>(null);
  const isRtl = language === "ar";
  const isFull = variant === "full";

  const handleClick = (id: string) => {
    if (!activeProvinces.includes(id)) return;
    onSelectProvince(selectedProvince === id ? null : id);
  };

  const getName = (p: Province) => {
    if (language === "ar") return p.nameAr;
    if (language === "fr") return p.nameFr;
    return p.nameEn;
  };

  const getProducts = (p: Province) =>
    language === "ar" ? p.products.ar : p.products.en;

  // ─── Label Item ────────────────────────────────────────────────────
  const LabelItem = ({
    province,
    side,
  }: {
    province: Province;
    side: "left" | "right";
  }) => {
    const isActive = activeProvinces.includes(province.id);
    const isSelected = selectedProvince === province.id;
    const isHov = hovered === province.id;

    return (
      <div
        onClick={() => handleClick(province.id)}
        onMouseEnter={() => setHovered(province.id)}
        onMouseLeave={() => setHovered(null)}
        style={{
          display: "flex",
          alignItems: "center",
          gap: "8px",
          padding: isFull ? "10px 14px" : "8px 10px",
          borderRadius: "12px",
          cursor: isActive ? "pointer" : "default",
          opacity: isActive ? 1 : 0.35,
          background: isSelected
            ? province.fillHover
            : isHov && isActive
            ? province.fillIdle
            : "transparent",
          border: isSelected
            ? `1.5px solid ${province.color}`
            : isHov && isActive
            ? `1.5px solid ${province.color}55`
            : "1.5px solid transparent",
          transition: "all 0.2s ease",
          direction: isRtl ? "rtl" : "ltr",
          flexDirection:
            side === "right" && !isRtl ? "row-reverse" : "row",
        }}
      >
        {/* Dot */}
        <div
          style={{
            width: "8px",
            height: "8px",
            borderRadius: "50%",
            flexShrink: 0,
            background: isSelected
              ? province.color
              : isActive
              ? `${province.color}88`
              : "#ccc",
            boxShadow: isSelected
              ? `0 0 0 3px ${province.color}28`
              : "none",
            transition: "all 0.2s",
          }}
        />
        <div style={{ flex: 1, minWidth: 0 }}>
          <div
            style={{
              fontWeight: 600,
              fontSize: isFull ? "13px" : "11px",
              color: isSelected ? province.color : "#3D405B",
              marginBottom: "1px",
              fontFamily:
                language === "ar"
                  ? "'Noto Sans Arabic', sans-serif"
                  : "inherit",
              transition: "color 0.2s",
            }}
          >
            {getName(province)}
          </div>
          <div
            style={{
              fontSize: isFull ? "10px" : "9px",
              color: isSelected ? `${province.color}bb` : "#aaa",
              fontFamily:
                language === "ar"
                  ? "'Noto Sans Arabic', sans-serif"
                  : "inherit",
              whiteSpace: "nowrap",
              overflow: "hidden",
              textOverflow: "ellipsis",
              maxWidth: isFull ? "145px" : "110px",
            }}
          >
            {getProducts(province)}
          </div>
        </div>
      </div>
    );
  };

  // ─── SVG Map ───────────────────────────────────────────────────────
  const MapSVG = () => {
    const getPolygonStyle = (province: Province) => {
      const isActive = activeProvinces.includes(province.id);
      const isSelected = selectedProvince === province.id;
      const isHov = hovered === province.id;
      return {
        fill: !isActive
          ? "#efefef"
          : isSelected
          ? province.fillSelected
          : isHov
          ? province.fillHover
          : province.fillIdle,
        stroke: !isActive
          ? "#ddd"
          : isSelected
          ? province.color
          : isHov
          ? province.color
          : `${province.color}66`,
        strokeWidth: isSelected ? 1.4 : isHov && isActive ? 1.2 : 0.8,
        cursor: isActive ? "pointer" : ("default" as React.CSSProperties["cursor"]),
        transition: "fill 0.22s ease, stroke 0.15s ease",
        filter: isSelected
          ? `drop-shadow(0 2px 6px ${province.color}44)`
          : "none",
      };
    };

    return (
      <svg
        viewBox="60 60 160 160"
        xmlns="http://www.w3.org/2000/svg"
        style={{ width: "100%", height: "auto", display: "block" }}
        aria-label="خريطة جهة كلميم واد نون"
      >
        {/* Sidi Ifni — 2 polygons */}
        {(() => {
          const p = provinceList.find((x) => x.id === "sidi-ifni")!;
          const style = getPolygonStyle(p);
          return (
            <g
              onClick={() => handleClick("sidi-ifni")}
              onMouseEnter={() => setHovered("sidi-ifni")}
              onMouseLeave={() => setHovered(null)}
            >
              <polygon
                points={sidiIfniPolygons.main}
                {...style}
                strokeLinejoin="round"
              />
              <polygon
                points={sidiIfniPolygons.north}
                {...style}
                strokeLinejoin="round"
              />
              {activeProvinces.includes("sidi-ifni") && (
                <text
                  x={p.lx}
                  y={p.ly}
                  textAnchor="middle"
                  fill={
                    selectedProvince === "sidi-ifni" ? "#fff" : p.color
                  }
                  fontSize={isFull ? 7 : 6}
                  fontWeight="700"
                  fontFamily="'Noto Sans Arabic', system-ui, sans-serif"
                  pointerEvents="none"
                  style={{ userSelect: "none" }}
                >
                  {getName(p)}
                </text>
              )}
            </g>
          );
        })()}

        {/* Guelmim, Tan-Tan, Assa-Zag */}
        {provinceList
          .filter((p) => p.id !== "sidi-ifni")
          .map((province) => {
            const style = getPolygonStyle(province);
            return (
              <g key={province.id}>
                <polygon
                  points={province.points}
                  {...style}
                  strokeLinejoin="round"
                  onClick={() => handleClick(province.id)}
                  onMouseEnter={() => setHovered(province.id)}
                  onMouseLeave={() => setHovered(null)}
                />
                {activeProvinces.includes(province.id) && (
                  <text
                    x={province.lx}
                    y={province.ly}
                    textAnchor="middle"
                    fill={
                      selectedProvince === province.id ? "#fff" : province.color
                    }
                    fontSize={isFull ? 7 : 6}
                    fontWeight="700"
                    fontFamily="'Noto Sans Arabic', system-ui, sans-serif"
                    pointerEvents="none"
                    style={{ userSelect: "none" }}
                  >
                    {getName(province)}
                  </text>
                )}
              </g>
            );
          })}
      </svg>
    );
  };

  // ─── Layout ────────────────────────────────────────────────────────
  const leftProvinces = provinceList.filter((p) =>
    ["guelmim", "tan-tan"].includes(p.id)
  );
  const rightProvinces = provinceList.filter((p) =>
    ["sidi-ifni", "assa-zag"].includes(p.id)
  );

  const sideWidth = isFull ? "160px" : "130px";

  return (
    <div
      style={{
        display: "flex",
        alignItems: "center",
        gap: isFull ? "12px" : "8px",
        width: "100%",
        maxWidth: isFull ? "780px" : "620px",
        margin: "0 auto",
        direction: isRtl ? "rtl" : "ltr",
      }}
    >
      {/* Left labels */}
      <div
        style={{
          display: "flex",
          flexDirection: "column",
          gap: "4px",
          flex: `0 0 ${sideWidth}`,
        }}
      >
        {leftProvinces.map((p) => (
          <div key={p.id}>
            <LabelItem province={p} side="left" />
          </div>
        ))}
      </div>

      {/* SVG Map */}
      <div style={{ flex: 1, minWidth: 0 }}>
        <MapSVG />
      </div>

      {/* Right labels */}
      <div
        style={{
          display: "flex",
          flexDirection: "column",
          gap: "4px",
          flex: `0 0 ${sideWidth}`,
        }}
      >
        {rightProvinces.map((p) => (
          <div key={p.id}>
            <LabelItem province={p} side="right" />
          </div>
        ))}
      </div>
    </div>
  );
};

export default GuelmimMap;
export const provinces = provinceList;